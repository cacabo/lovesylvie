if (self.CavalryLogger) { CavalryLogger.start_js(["FGGZf"]); }

__d("MessengerLiveLocationETAQueryWebGraphQLQuery",["WebGraphQLQueryBase"],(function a(b,c,d,e,f,g){"use strict";f.exports=function(){var h,i;h=babelHelpers.inherits(j,c("WebGraphQLQueryBase"));i=h&&h.prototype;j.__getDocID=function(){"use strict";return"557024247754605"};j.getQueryID=function(){"use strict";return"1414244725326295"};function j(){"use strict";h.apply(this,arguments)}return j}()}),null);
__d("MercuryMessageLiveLocationETAFetcher",["Promise","DateConsts","Map","MessengerLiveLocationETAQueryWebGraphQLQuery","WebGraphQL","idx","nullthrows"],(function a(b,c,d,e,f,g){"use strict";var h=60,i=new(c("Map"))();function j(m){if(!i.has(m))return false;var n=c("nullthrows")(i.get(m)),o=Date.now()-n.timestamp.getTime();return o<=c("DateConsts").MS_PER_SEC*h}function k(m){return new(c("Promise"))(function(n,o){var p=c("nullthrows")(m.coordinate),q=c("nullthrows")(m.sender_destination);c("WebGraphQL").exec(new(c("MessengerLiveLocationETAQueryWebGraphQLQuery"))({queryParams:{gps_points:[{latitude:p.latitude,longitude:p.longitude},{latitude:q.latitude,longitude:q.longitude}],transportation:"CAR",traffic:true}})).done(function(r){var s,t=((s=r)!=null?(s=s.routing_eta)!=null?(s=s.routing_eta_data)!=null?(s=s.nodes)!=null?(s=s[0])!=null?s.eta_traffic:s:s:s:s:s)||null;if(t===null){o();return}var u=Math.ceil(t/c("DateConsts").SEC_PER_MIN);n(u)})})}var l={isLiveLocationEligibleForETA:function m(n){return!!n.coordinate&&!!n.sender_destination&&!n.is_expired},fetchETAToDestination:function m(n){if(!l.isLiveLocationEligibleForETA(n))throw new Error("Cannot fetch ETA for live location");return new(c("Promise"))(function(o,p){var q=n.live_location_id;if(j(q)){var r=c("nullthrows")(i.get(q));o(r.etaInMinutes);return}i.set(q,{timestamp:new Date(),etaInMinutes:null});k(n).done(function(s){i.set(q,{timestamp:new Date(),etaInMinutes:s});o(s)})})}};f.exports=l}),null);
__d("LiveLocationStopReason",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({EXPIRED:1,CANCELED:2,ARRIVED:3})}),null);
__d("MercuryMessageLiveLocationShareAttachmentGenerator",["fbt","DateConsts","GeoCoordinates","GeoMarker","LiveLocationStopReason","MercuryIDs","MercuryParticipants","MercuryViewer","StaticGeoMapBase.react","URI","formatDate","keyMirror"],(function a(b,c,d,e,f,g,h){"use strict";var i=c("keyMirror")(c("LiveLocationStopReason")),j=545,k=280,l=15,m={generateShareAttachment:function B(C,D,E){var F=A(C);return babelHelpers["extends"]({},D,{target:C,title:n(C).toString(),description:s(C,E).toString(),media:babelHelpers["extends"]({},D.media,{image:F&&F.toString()||"",image_size:{width:j,height:k}}),uri:""})}};function n(B){if(B.is_expired)return p(B);else return o(B)}function o(B){if(B.location_title)return B.location_title;else return h._("Live Location")}function p(B){var C=B.sender_destination;if(C&&B.stop_reason===i.ARRIVED)return q(C,B.sender.id);return h._("Location sharing ended")}function q(B,C){var D=B.label,E=c("MercuryIDs").getParticipantIDFromUserID(C);if(c("MercuryViewer").isViewer(E))if(D)return h._("You arrived at {destination}",[h.param("destination",D)]);else return h._("You arrived at the destination");else{var F=r(E);if(D!=null)if(F!=null)return h._("{user} arrived at {destination}",[h.param("user",F),h.param("destination",D)]);else return h._("Arrived at {destination}",[h.param("destination",D)]);else if(F!=null)return h._("{user} arrived at the destination",[h.param("user",F)]);else return h._("Arrived at the destination")}}function r(B){var C=c("MercuryParticipants").getNow(B);return C&&C.short_name}function s(B,C){if(B.is_expired)return w(B);else{var D=B.sender_destination;if(D)return z(D,C);else return y(B.expiration_time)}}function t(B,C){return B.getDate()==B.getDate()&&B.getMonth()===C.getMonth()&&B.getFullYear()===C.getFullYear()}function u(B){return new Date(B*c("DateConsts").MS_PER_SEC)}function v(B){var C=new Date(),D=u(B),E=C.getTime()-D.getTime();if(t(C,D))return"g:ia";else if(E<c("DateConsts").MS_PER_WEEK)return"D g:ia";else return"M j"}function w(B){var C=B.expiration_time,D=c("formatDate")(C,v(C));return h._("Last update {date}",[h.param("date",D)])}function x(B){var C=u(B).getTime()-Date.now();return Math.ceil(C/(c("DateConsts").MS_PER_SEC*c("DateConsts").SEC_PER_MIN))}function y(B){var C=x(B);return h._({"*":"Sharing for {number} minutes.","_1":"Sharing for 1 minute."},[h.plural(C,"number")])}function z(B,C){if(C)if(B.label)return h._("{eta_in_minutes} minute drive to {destination}.",[h.param("eta_in_minutes",C),h.param("destination",B.label)]);else return h._("{eta_in_minutes} minute drive to the destination.",[h.param("eta_in_minutes",C)]);else if(B.label)return h._("Sharing until {destination}.",[h.param("destination",B.label)]);else return h._("Sharing until destination.")}function A(B){var C=B.coordinate;if(!C)return null;var D=new(c("GeoMarker"))(new(c("GeoCoordinates"))(C.latitude,C.longitude));return c("StaticGeoMapBase.react").getMapImageURI({size:{width:j,height:k},zoom:l,markers:[D],boundingBox:null,center:null,paths:null})}f.exports=m}),null);
__d("MercuryMessageLiveLocationShareAttachment.react",["cx","Link.react","MercuryFallbackShareAttachmentContent.react","MercuryMessageLiveLocationETAFetcher","MercuryMessageLiveLocationShareAttachmentGenerator","MercuryShareAttachmentRenderLocations","MercuryShareAttachmentReactShape","React","XPlacesMapController","nullthrows"],(function a(b,c,d,e,f,g,h){"use strict";var i,j,k=c("React").PropTypes;i=babelHelpers.inherits(l,c("React").Component);j=i&&i.prototype;function l(){var m,n;for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return n=(m=j.constructor).call.apply(m,[this].concat(p)),this.state={etaInMinutes:null},n}l.prototype.componentDidMount=function(){this.$MercuryMessageLiveLocationShareAttachment1(this.state.etaInMinutes)};l.prototype.componentDidUpdate=function(m,n){this.$MercuryMessageLiveLocationShareAttachment1(n.etaInMinutes)};l.prototype.render=function(){var m=this.props.attachment,n=c("MercuryMessageLiveLocationShareAttachmentGenerator").generateShareAttachment(this.$MercuryMessageLiveLocationShareAttachment2(m),m,this.state.etaInMinutes),o=this.$MercuryMessageLiveLocationShareAttachment3(n),p=this.$MercuryMessageLiveLocationShareAttachment2(n);if(c("MercuryShareAttachmentRenderLocations").isPreview(this.props.location)||p.is_expired)return o;var q=c("XPlacesMapController").getURIBuilder().setInt("message_live_location_id",p.live_location_id).getURI();return c("React").createElement(c("Link.react"),{className:"_5rw4",href:n.uri,ajaxify:q,rel:"dialog",target:"_blank"},o)};l.prototype.$MercuryMessageLiveLocationShareAttachment3=function(m){var n=babelHelpers["extends"]({},this.props,{attachment:m});return c("React").createElement(c("MercuryFallbackShareAttachmentContent.react"),n)};l.prototype.$MercuryMessageLiveLocationShareAttachment2=function(m){return c("nullthrows")(m.target)};l.prototype.$MercuryMessageLiveLocationShareAttachment1=function(m){var n=this.$MercuryMessageLiveLocationShareAttachment2(this.props.attachment);if(!c("MercuryMessageLiveLocationETAFetcher").isLiveLocationEligibleForETA(n))return;c("MercuryMessageLiveLocationETAFetcher").fetchETAToDestination(n).done(function(o){if(o&&m!=o)this.setState({etaInMinutes:o})}.bind(this))};l.propTypes={attachment:c("MercuryShareAttachmentReactShape"),location:k.oneOf(c("MercuryShareAttachmentRenderLocations").getValues())};f.exports=l}),null);