if (self.CavalryLogger) { CavalryLogger.start_js(["qEMau"]); }

__d("MessengerComposerContainer.react",["fbt","Arbiter","AsyncUploadRequest","EmojiLikeUtils","EmojiState","EmojiDispatcher","immutable","MercuryAttachment","MercuryAttachmentType","MercuryConfig","MercuryThreadIDMap","MercuryThreadInformer","MercuryIDs","MercuryLocalIDs","MercuryMessageActions","MercuryMessageObject","MercuryParticipants","MercurySendMessageHandler","MercuryThreads","MercuryThreadActions","MercuryTriodeSourceUtil","MessageRequestUtils","MessengerActions","MessengerComposer.react","MessengerComposerActions","messengerDialogsRe","MessengerEmojiUsageUtils","messengerSimpleDialogReact","MessengerView","MNPlatformTagsDataManager","P2PPaymentConfig","PhotosUploadID","React","ReactDOM","SearchableEntry","SubscriptionsHandler","nullthrows","setImmediate","EmojiStateStore"],(function a(b,c,d,e,f,g,h){"use strict";var i,j,k=c("messengerSimpleDialogReact").jsComponent,l=c("React").PropTypes;i=babelHelpers.inherits(m,c("React").PureComponent);j=i&&i.prototype;function m(){var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=j.constructor).call.apply(o,[this].concat(r)),this.$MessengerComposerContainer8=function(t,u,v){c("EmojiState").updateRecentlyUsed(c("MessengerEmojiUsageUtils").findAllEmojis(t));if(!this.props.canReply){v&&v(null);return false}var w=null,x=false;if(!this.$MessengerComposerContainer15(t,u))x=this.$MessengerComposerContainer16(function(y){var z=this.$MessengerComposerContainer2.constructUserGeneratedMessageObject(t,c("MercuryTriodeSourceUtil").getMercuryTriodeSource(),y),A=c("MercuryIDs").getUserIDFromThreadID(y);if(c("MNPlatformTagsDataManager").hasThreadTags(A)){var B=c("MNPlatformTagsDataManager").getThreadTags();z.tags=B}if(u){if(u.shareable_attachment)z.shareable_attachment=u.shareable_attachment;if(u.profile_ranges)z.profile_ranges=z.profile_xmd=u.profile_ranges}w=z;return z}.bind(this));v&&v(x?w:null);w=null;return x}.bind(this),this.$MessengerComposerContainer10=function(t,u){this.$MessengerComposerContainer3.cancelAttachmentPlaceholder(u.upload_id,u)}.bind(this),this.$MessengerComposerContainer9=function(t,u){this.$MessengerComposerContainer3.confirmAttachmentPlaceholder(u.upload_id,u)}.bind(this),this.$MessengerComposerContainer11=function(t,u){this.$MessengerComposerContainer3.cancelAttachmentPlaceholder(u.upload_id,u);var v=h._("Photo Upload failed"),w=h._("Please try again. Make sure you are uploading a valid photo.");if(u.errorDialogParams){v=u.errorDialogParams.title||v;w=u.errorDialogParams.body||w}this.$MessengerComposerContainer17(v,w)}.bind(this),this.$MessengerComposerContainer12=function(t,u){this.$MessengerComposerContainer16(function(v){return this.$MessengerComposerContainer2.constructAttachmentMessageObject(c("MercuryTriodeSourceUtil").getMercuryTriodeSource(),v)}.bind(this),function(v){this.$MessengerComposerContainer3.addAttachmentPlaceholder(v,u.upload_id,u);this.handleMessageSentToPendingThread()}.bind(this))}.bind(this),this.handleAudioUpload=function(t){var u="upload_"+c("PhotosUploadID").getNewID();this.$MessengerComposerContainer1.sendAttachment(this.props.threadID,n(u),c("MercuryTriodeSourceUtil").getMercuryTriodeSource());var v={};v[u]=t;var w=new(c("AsyncUploadRequest"))(c("MercuryConfig").upload_url).setAllowCrossOrigin(true).setRelativeTo(c("ReactDOM").findDOMNode(this)).setData({voice_clip:true}).setFiles(v);this.$MessengerComposerContainer4.addSubscriptions(w.subscribe("success",function(x,y){return this.$MessengerComposerContainer18(y)}.bind(this)));w.send()}.bind(this),this.$MessengerComposerContainer13=function(t){return this.$MessengerComposerContainer16(function(u){return this.$MessengerComposerContainer2.constructStickerMessageObject(t,c("MercuryTriodeSourceUtil").getMercuryTriodeSource(),u)}.bind(this))}.bind(this),this.$MessengerComposerContainer14=function(t,u,v){var w=this.props.threadID,x=this.$MessengerComposerContainer2.constructUserGeneratedMessageObject(t.emoji,c("MercuryTriodeSourceUtil").getMercuryTriodeSource(),w);x.has_attachment=false;return this.$MessengerComposerContainer16(function(w){c("EmojiLikeUtils").setEmojiSize(x,u);return c("EmojiLikeUtils").setEmojiSource(x,v)})}.bind(this),this.handleMessageSentToPendingThread=function(){if(this.props.thread&&c("MessageRequestUtils").isMessageRequest(this.props.thread))c("MercuryThreadActions").getForFBID(this.props.viewer).movePendingToInbox(this.props.threadID)}.bind(this),this.$MessengerComposerContainer7=function(t,event){if(event.threadID===this.props.threadID)c("MercuryParticipants").get(event.participantID,function(u){if(!u||!this.refsComposer)return;var v=new(c("SearchableEntry"))({uniqueID:c("nullthrows")(u.fbid),title:"@"+u.name});c("setImmediate")(function(){if(this.refsComposer){this.refsComposer.focusInput();this.refsComposer&&this.refsComposer.replyToMention&&this.refsComposer.replyToMention(v)}}.bind(this))}.bind(this))}.bind(this),p}m.prototype.componentDidMount=function(){this.$MessengerComposerContainer1=c("MercurySendMessageHandler").getForFBID(this.props.viewer);this.$MessengerComposerContainer3=c("MercuryMessageActions").getForFBID(this.props.viewer);this.$MessengerComposerContainer5=c("MercuryThreads").getForFBID(this.props.viewer);this.$MessengerComposerContainer2=c("MercuryMessageObject").getForFBID(this.props.viewer);this.$MessengerComposerContainer6=c("MercuryThreadInformer").getForFBID(this.props.viewer);this.$MessengerComposerContainer4=new(c("SubscriptionsHandler"))();c("EmojiDispatcher").explicitlyRegisterStores([c("EmojiStateStore")]);if(c("MercuryConfig").MentionsReplyEvent)this.$MessengerComposerContainer4.addSubscriptions(c("Arbiter").subscribe(c("MercuryConfig").MentionsReplyEvent,this.$MessengerComposerContainer7));this.props.onMount&&this.props.onMount(this)};m.prototype.componentWillUnmount=function(){this.$MessengerComposerContainer4.release()};m.prototype.focusInput=function(){this.refsComposer&&this.refsComposer.focusInput&&this.refsComposer.focusInput()};m.prototype.render=function(){return c("React").createElement(c("MessengerComposer.react"),{canReply:this.props.canReply,fileUploader:this.props.fileUploader,mentionsEnabled:true,onMessageSend:this.$MessengerComposerContainer8,onPhotoUploadComplete:this.$MessengerComposerContainer9,onPhotoUploadCancel:this.$MessengerComposerContainer10,onPhotoUploadFail:this.$MessengerComposerContainer11,onPhotoUploadSubmit:this.$MessengerComposerContainer12,onResize:this.props.onResize,onStickerSelect:this.$MessengerComposerContainer13,onCustomLikeSelect:this.$MessengerComposerContainer14,onVoiceClipCreate:this.handleAudioUpload,p2pPaymentConfig:c("P2PPaymentConfig").config,participants:this.props.participants,recipients:this.props.recipients,ref:function(o){return this.refsComposer=o}.bind(this),sharePreview:this.props.sharePreview,threadID:this.props.threadID,threadFBID:this.props.threadFBID,thread:this.props.thread,view:this.props.view,viewer:this.props.viewer})};m.prototype.$MessengerComposerContainer15=function(o,p){if(o)return false;return!(p&&(p.shareable_attachment||p.profile_ranges.length>0))};m.prototype.$MessengerComposerContainer18=function(o){var p=o.getName(),q=o.getResponse().payload.metadata[0].audio_id;this.$MessengerComposerContainer3.confirmAttachmentPlaceholder(p,{upload_id:p,audio_ids:[q]})};m.prototype.handleFileUpload=function(o){var p=o.reduce(function(p,q){var r=q.type.split("/")[0];if(p[r])p[r].push(q);else p.other.push(q);return p},{audio:[],image:[],other:[]});p.audio.forEach(function(q){return this.handleAudioUpload(q)}.bind(this));if(this.refsComposer)this.refsComposer.handleFileUpload(p.image.concat(p.other))};m.prototype.handleTextDropped=function(o){if(this.refsComposer)this.refsComposer.handleTextDropped(o)};m.prototype.$MessengerComposerContainer16=function(o,p){var q=this.props.threadID,r=this.props.recipients,s=false;if(!q&&r&&r.size>1){q=c("MercuryLocalIDs").generateThreadID();s=true}if(!q)return false;var t=o(q);if(s){var u=r.map(function(v){return c("MercuryIDs").getParticipantIDFromUserID(v.getUniqueID())}).toArray();this.$MessengerComposerContainer5.createNewLocalThread(q,u);t.offline_threading_id=c("MercuryIDs").tokenize(q).value;t.specific_to_list=u}if(p)p(t);else this.$MessengerComposerContainer3.send(t,this.handleMessageSentToPendingThread);if(this.props.view===c("MessengerView").DETAIL.COMPOSE){if(c("MercuryAttachment").get(t).length>0)c("MessengerComposerActions").moveDraftToNextThread(q);c("MessengerComposerActions").exitComposeState();if(c("MercuryIDs").isLocalThread(q))this.$MessengerComposerContainer6.subscribeOnce("messages-updated",function(v,w){var x=c("MercuryThreadIDMap").get();if(x.canLinkExternally(q))c("MessengerActions").selectThread(q)});else c("MessengerActions").selectThread(q)}this.focusInput();return true};m.prototype.resetDrag=function(){if(this.refsComposer)this.refsComposer.exitCurrentMode()};m.prototype.$MessengerComposerContainer17=function(o,p){c("messengerDialogsRe").showDialog(function(){return c("React").createElement(k,{title:o,body:p})})};m.propTypes={canReply:l.bool,fileUploader:l.object,onMount:l.func,onResize:l.func,participants:l.instanceOf(c("immutable").Map),recipients:l.instanceOf(c("immutable").List),sharePreview:l.object,threadID:l.string,threadFBID:l.string,thread:l.object,view:l.string,viewer:l.string};function n(o){return{upload_id:o,preview_attachments:[{upload_id:o,attach_type:c("MercuryAttachmentType").PHOTO,preview_uploading:true}]}}f.exports=m}),null);